<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>账号管理</title>
    <link href="../bootstrap-3.3.7-dist/css/bootstrap.min.css" media="screen" rel="stylesheet">
    <link href="../assets/css/component.css" rel="stylesheet">
</head>
<body>
<div class="container-fluid container-accountManagement">
    <div class="row accountManagement-top">
        <form class="form-inline">
            <div class="form-group">
                <label for="selectAdminID">账号：</label>
                <input type="text" class="form-control" id="selectAdminID" placeholder="账号">
            </div>
            <div class="form-group accountManagement-form-group2">
                <label for="selectAdminname">使用人：</label>
                <input type="email" class="form-control" id="selectAdminname" placeholder="使用人">
            </div>
            <div class="form-group accountManagement-form-group3">
                <label>状态：</label>
                <select id="selectAdminStatus" class="form-control">
                    <option>===请选择===</option>
                    <option>正常</option>
                    <option>冻结</option>
                </select>
            </div>
        </form>
    </div>
    <div class="row accountManagement-button">
        <div class="col-md-9"></div>
        <div class="col-md-3">
            <button type="submit" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal01">创建管理员账号</button>
            <!--第一个模态框-->
            <div class="modal fade" id="exampleModal01" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title" id="exampleModalLabel">创建管理员账号</h4>
                        </div>
                        <div class="modal-body">
                            <form id="form-create" class="form-inline">
                                <div class="row accountManagement-modal-input1">
                                    <div class="form-group">
                                        <label >账号名：</label>
                                        <input name="adminname" id="create-username" type="text" class="form-control" placeholder="账号名">
                                    </div>
                                </div>
                                <div class="row accountManagement-modal-input2">
                                    <div class="form-group">
                                        <label >密&nbsp;&nbsp;&nbsp;&nbsp;码：</label>
                                        <input name="password" type="text" class="form-control" placeholder="密码">
                                    </div>
                                </div>
                                <label style="margin-left: 210px;font-weight:lighter">默认密码：888888</label>
                                <div class="row accountManagement-modal-input3">
                                    <div class="form-group">
                                        <label >归属人：</label>
                                        <select name="belonger" class="form-control">
                                            <option>Mike</option>
                                            <option>Jony</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="modal-footer" style="margin-top: 15px">
                                    <button id="btn-create" type="button" class="btn btn-primary">创建账号</button>
                                </div>
                            </form>
                        </div>

                    </div>
                </div>
            </div>
            <button id="selectAdmin" type="submit" class="btn btn-primary">查询</button>
        </div>
    </div>
    <div class="row accountManagement-table table-responsive">
        <table class="table table-striped">
            <thead>
            <tr>
                <th>账号</th>
                <th>
                    <div style="margin-left: 100px">
                    使用人
                    </div>
                </th>
                <th>
                    <div style="margin-left: 100px">
                        状态
                    </div>
                </th>
                <th>
                    <div style="margin-left: 100px">
                        操作
                    </div>
                </th>
            </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
        <!--第二个模态框-->
        <div class="modal fade" id="exampleModal02" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="exampleModalLabel01">修改账号归属</h4>
                        <label id="adminId" style="display: none"></label>
                    </div>
                    <div class="modal-body">
                        <form class="form-inline">
                            <div class="row accountManagement-modal-input3">
                                <div class="form-group">
                                    <label >归属人：</label>
                                    <select id="adminBelonger" class="form-control">
                                        <option>Mike</option>
                                        <option>Jony</option>
                                    </select>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button id="modifyBelongerByAid" type="button" class="btn btn-primary">提交修改</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="accountManagement-pagination row">
        <div class="col-md-9"></div>
        <div class="col-md-3" id="page">
            <nav aria-label="...">
                <ul class="pagination">
                    <li class="disabled" id="pre"><a href="#" aria-label="Previous"><span aria-hidden="true">«</span></a></li>
                    <li class="active aPage" id="li01"><a href="#l1" aria-controls="l1" role="tab" data-toggle="tab">1</a></li>
                    <li id="next"><a href="#" aria-label="Next"><span aria-hidden="true">»</span></a></li>
                </ul>
            </nav>
        </div>
    </div>
</div>

<script src="../assets/js/jquery.min.js"></script>
<script src="../bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>
<script src="../assets/webjs/account.js"></script>
<script>
    //创建管理员请求的AJAX代码
    $("#btn-create").click(function () {
        if ($("#create-username").val()===""){
            alert("账号名不能为空！")
        }else {
            $.ajax({
                "url": "/admins/create",
                "data": $("#form-create").serialize(),
                "type": "post",
                "dataType": "json",
                "success": function (json) {
                    if (json.state === 2000) {
                        alert("管理员创建成功！");
                        // 跳转到某个页面
                        location.href="/static/web/accountManagement.html";
                        window.event.returnValue=false;
                    } else {
                        alert(json.message);
                    }
                }
            });
        }
    });
    //冻结AJAX
    function freezeAdmin(obj) {
        var aid = $(obj).parent().parent().prev().prev().prev().text();
        var status = ($(obj).parent().parent().prev().text() === "正常") ? 1 : 0;
        console.log("cid:"+aid+",status:"+status);
        $.ajax({
            "url": "/admins/"+aid+"/changeStatus/"+status,
            "type": "post",
            "dataType": "json",
            "success": function (json) {
                if (json.state === 2000) {
                    alert("状态修改成功！")
                    location.href="/static/web/accountManagement.html"
                } else {
                    alert(json.message);
                }
            }
        });
    }
    //删除管理员AJAX
    function deleteAdmin(obj) {
        var aid = $(obj).parent().parent().prev().prev().prev().text();
        if (confirm("您确定要删除此管理员吗？")){
            $.ajax({
                "url": "/admins/" + aid + "/delete_admin",
                "type": "POST",
                "dataType": "json",
                "success": function (json) {
                    if (json.state === 2000) {
                        location.href="/static/web/accountManagement.html";
                    } else {
                        alert(json.message);
                        location.href="/static/web/accountManagement.html";
                    }
                },
                "error": function () {
                    alert("您的登录信息已过期，请重新登录！");
                }
            });
        }
    }
    //修改归属人按钮
    function modifyBelonger(obj) {
        var aid = $(obj).parent().parent().prev().prev().prev().text();
        $.ajax({
            "url": "/admins/" + aid + "/findAdmin",
            "type": "GET",
            "dataType": "json",
            "success": function (json) {
                if (json.state === 2000) {
                    $("#adminId").text(json.data.aid);
                    $("#adminBelonger").val(json.data.belonger)
                } else {
                    alert(json.message);
                }
            },
            "error": function () {
                alert("您的登录信息已过期，请重新登录！");
            }
        });
    }
    //根据aid修改归属人AJAX
    $("#modifyBelongerByAid").click(function () {
        var aid = $("#adminId").text();
        var belonger = $("#adminBelonger").val();
        $.ajax({
            "url": "/admins/"+aid+"/changeBelonger/"+belonger,
            "type": "post",
            "dataType": "json",
            "success": function (json) {
                if (json.state === 2000) {
                    alert("归属人修改成功！")
                    location.href="/static/web/accountManagement.html"
                } else {
                    alert(json.message);
                }
            }
        });
    })
    $("#selectAdmin").click(function () {
        var aid=$("#selectAdminID").val();
        var adminname=$("#selectAdminname").val();
        var status=($("#selectAdminStatus").val()==="正常")?0:1;
        $.ajax({
            "url": "/admins/"+aid+"/findAdminByCondition/"+adminname+"/"+status,
            "type": "get",
            "dataType": "json",
            "success": function (json) {
                if (json.state === 2000) {
                    var list = json.data;
                    $("tbody").empty();
                    $("#page").empty();
                    var html='<tr>'
                        +'<th>#{aid}</th>'
                        +'<td><div style="margin-left: 100px">#{adminname}</div></td>'
                        +'<td><div style="margin-left: 100px">#{status}</div></td>'
                        +'<td><div style="margin-left: 100px"><button type="button" class="freeze btn btn-info" onclick="freezeAdmin(this)">冻结</button><button style="margin-left:4px" type="button" class="delete btn btn-danger" onclick="deleteAdmin(this)">删除</button><button style="margin-left:4px" type="button" class="modify btn btn-success" data-toggle="modal" data-target="#exampleModal02" onclick="modifyBelonger(this)">修改归属</button></div></td>'
                        +'</tr>';
                    html = html.replace(/#{aid}/g, list.aid);
                    html = html.replace(/#{adminname}/g, list.adminname);
                    html = html.replace(/#{status}/g, (list.status===0)?"正常":"冻结");

                    $("tbody").append(html);
                } else {
                    alert(json.message);
                }
            }
        });
    })
</script>
</body>
</html>